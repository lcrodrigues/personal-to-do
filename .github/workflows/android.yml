name: App Center CI

on:
  push:
    branches:
      - development

jobs:
  build:
    runs-on: macos-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v2

      - name: Set up Java
        uses: actions/setup-java@v2
        with:
          java-version: 11

      - name: Build and Test
        run: |
          ./gradlew assembleDebug
          ./gradlew test

      - name: Deploy to App Center
        env:
          APP_CENTER_API_TOKEN: ${{ secrets.APP_CENTER_API_TOKEN }}
        run: |
          curl -X POST -H "Content-Type: application/json" -d '{
            "branchName": "development",
            "app_name": "PersonalToDo",
            "build_target_name": "development-build"
          }' "https://appcenter.ms/users/lcrodrigues/apps/PersonalToDo-Alpha/build/branches"
